{"remainingRequest":"G:\\pdf\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\pdf\\src\\components\\previewPDF.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\pdf\\src\\components\\previewPDF.vue","mtime":1611732235569},{"path":"G:\\pdf\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1602294150526},{"path":"G:\\pdf\\node_modules\\babel-loader\\lib\\index.js","mtime":1606880660519},{"path":"G:\\pdf\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1602294150526},{"path":"G:\\pdf\\node_modules\\vue-loader\\lib\\index.js","mtime":1608703742340}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpjb25zdCBQREZKUyA9IHJlcXVpcmUoJ3BkZmpzLWRpc3QnKTsNClBERkpTLkdsb2JhbFdvcmtlck9wdGlvbnMud29ya2VyU3JjID0NCiAgJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL3BkZi5qcy8yLjYuMzQ3L3BkZi53b3JrZXIuanMnOw0KZXhwb3J0IGRlZmF1bHQgew0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICB0b3RhbFBhZ2VzOiBbXSwgLy8g5oC76aG15pWwDQogICAgICBjdXJyZW50UGFnZTogMSwgLy8g5b2T5YmN6aG1DQogICAgICBwYWdlUmVuZGVyaW5nOiBmYWxzZSwgLy8g5piv5ZCm5q2j5Zyo5riy5p+TDQogICAgICBwYWdlTnVtUGVuZGluZzogbnVsbCwgLy8g5b6F5aSE55CG6aG156CBDQogICAgICBwZGZXaWR0aDogJycsIC8vIOWuveW6pg0KICAgICAgcGRmU3JjOiAnJywgLy8g5Zyw5Z2ADQogICAgICBwZGZEb2M6IG51bGwsIC8vIOaWh+aho+WGheWuuQ0KICAgICAgcGRmU2NhbGU6IDEuMCAvLyDmlL7lpKflgI3mlbANCiAgICAgIC8vIGlzTG9hZGluZzogZmFsc2UgLy8g5paH5qGj5piv5ZCm5q2j5Zyo5Yqg6L29DQogICAgfTsNCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmdldFBkZlVybCgpOw0KICB9LA0KICB3YXRjaDogew0KICAgIHBhZ2VSZW5kZXJpbmcobmV3VmFsLCBvbGQpIHsNCiAgICAgIC8vIHRoaXMuaXNMb2FkaW5nID0gbmV3VmFsOw0KICAgICAgY29uc29sZS5sb2cob2xkKTsNCiAgICB9DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBnZXRQZGZVcmwoKSB7DQogICAgICAvLyB0b2RvIOivt+axguWQjuWPsO+8jOiOt+WPlnBkZueahHVybO+8jOazqOaEj+i/memHjOS4jeiDveaYr+acrOWcsOeahHBkZuaWh+S7tg0KICAgICAgdGhpcy5wZGZTcmMgPQ0KICAgICAgICAnaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21vemlsbGEvcGRmLmpzL2JhMmVkZWFlL3dlYi9jb21wcmVzc2VkLnRyYWNlbW9ua2V5LXBsZGktMDkucGRmJzsNCiAgICAgIHRoaXMubG9hZEZpbGUodGhpcy5wZGZTcmMpOw0KICAgIH0sDQogICAgbG9hZEZpbGUodXJsKSB7DQogICAgICAvL+mAmui/h3Byb21pc2Xojrflj5bpobXpnaINCiAgICAgIGxldCBsb2FkaW5nVGFzayA9IFBERkpTLmdldERvY3VtZW50KHVybCk7DQogICAgICB0aGlzLnBhZ2VSZW5kZXJpbmcgPSB0cnVlOw0KICAgICAgbG9hZGluZ1Rhc2sucHJvbWlzZS50aGVuKChwZGYpID0+IHsNCiAgICAgICAgdGhpcy5wZGZEb2MgPSBwZGY7DQogICAgICAgIHRoaXMudG90YWxQYWdlcyA9IHBkZi5udW1QYWdlczsNCiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgIHRoaXMucmVuZGVyUGFnZSgxKTsgLy8g5Yid5aeLL+mmlumhtea4suafkw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgcmVuZGVyUGFnZShudW0pIHsNCiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBudW07IC8vIOabtOaWsOW9k+WJjemhteeggQ0KICAgICAgdGhpcy5wZGZEb2MuZ2V0UGFnZShudW0pLnRoZW4oKHBhZ2UpID0+IHsNCiAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZGZDYW52YXMnKTsNCiAgICAgICAgbGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICBsZXQgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsNCiAgICAgICAgbGV0IGJzciA9DQogICAgICAgICAgY3R4LndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwNCiAgICAgICAgICBjdHgubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fA0KICAgICAgICAgIGN0eC5tc0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwNCiAgICAgICAgICBjdHgub0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwNCiAgICAgICAgICBjdHguYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fA0KICAgICAgICAgIDE7DQogICAgICAgIGxldCByYXRpbyA9IGRwciAvIGJzcjsNCiAgICAgICAgbGV0IHZpZXdwb3J0ID0gcGFnZS5nZXRWaWV3cG9ydCh7IHNjYWxlOiB0aGlzLnBkZlNjYWxlIH0pOw0KICAgICAgICBjYW52YXMud2lkdGggPSB2aWV3cG9ydC53aWR0aCAqIHJhdGlvOw0KICAgICAgICBjYW52YXMuaGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0ICogcmF0aW87DQoNCiAgICAgICAgY2FudmFzLnN0eWxlLndpZHRoID0gdmlld3BvcnQud2lkdGggKyAncHgnOw0KDQogICAgICAgIHRoaXMucGRmV2lkdGggPSB2aWV3cG9ydC53aWR0aCArICdweCc7DQoNCiAgICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCArICdweCc7DQoNCiAgICAgICAgY3R4LnNldFRyYW5zZm9ybShyYXRpbywgMCwgMCwgcmF0aW8sIDAsIDApOw0KICAgICAgICAvLyDlsIYgUERGIOmhtemdoua4suafk+WIsCBjYW52YXMg5LiK5LiL5paH5LitDQogICAgICAgIGxldCByZW5kZXJDb250ZXh0ID0gew0KICAgICAgICAgIGNhbnZhc0NvbnRleHQ6IGN0eCwNCiAgICAgICAgICB2aWV3cG9ydDogdmlld3BvcnQNCiAgICAgICAgfTsNCiAgICAgICAgbGV0IHJlbmRlclRhc2sgPSBwYWdlLnJlbmRlcihyZW5kZXJDb250ZXh0KTsNCiAgICAgICAgcmVuZGVyVGFzay5wcm9taXNlLnRoZW4oKCkgPT4gew0KICAgICAgICAgIHRoaXMucGFnZVJlbmRlcmluZyA9IGZhbHNlOw0KICAgICAgICAgIGlmICh0aGlzLnBhZ2VOdW1QZW5kaW5nID09PSBudWxsKSByZXR1cm47DQogICAgICAgICAgdGhpcy5yZW5kZXJQYWdlKHRoaXMucGFnZU51bVBlbmRpbmcpOw0KICAgICAgICAgIHRoaXMucGFnZU51bVBlbmRpbmcgPSBudWxsOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgb25QcmVQYWdlKCkgew0KICAgICAgLy8g5LiK5LiA6aG1DQogICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA8PSAxKSByZXR1cm47DQogICAgICB0aGlzLmN1cnJlbnRQYWdlLS07DQogICAgICB0aGlzLnF1ZXVlUmVuZGVyKHRoaXMuY3VycmVudFBhZ2UpOw0KICAgIH0sDQogICAgb25OZXh0UGFnZSgpIHsNCiAgICAgIC8vIOS4i+S4gOmhtQ0KICAgICAgaWYgKHRoaXMuY3VycmVudFBhZ2UgPj0gdGhpcy50b3RhbFBhZ2VzKSByZXR1cm47DQogICAgICB0aGlzLmN1cnJlbnRQYWdlKys7DQogICAgICB0aGlzLnF1ZXVlUmVuZGVyKHRoaXMuY3VycmVudFBhZ2UpOw0KICAgIH0sDQogICAgcXVldWVSZW5kZXIobnVtKSB7DQogICAgICAvL+a4suafk+etieW+he+8m+WmguaenOato+WcqOi/m+ihjOWPpuS4gOS4qumhtemdoua4suafk++8jOivt+etieW+hea4suafk+WujOaIkOOAgiDlkKbliJnvvIznq4vljbPmiafooYzmuLLmn5MNCiAgICAgICF0aGlzLnBhZ2VSZW5kZXJpbmcgPyB0aGlzLnJlbmRlclBhZ2UobnVtKSA6ICh0aGlzLnBhZ2VOdW1QZW5kaW5nID0gbnVtKTsNCiAgICB9DQogIH0NCn07DQo="},{"version":3,"sources":["previewPDF.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"previewPDF.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"preview-pdf\">\r\n    <h1>PDF在线预览</h1>\r\n    <div style=\"text-align:center;\">\r\n      <button id=\"prev\" @click=\"onPrePage\">\r\n        Previous\r\n      </button>\r\n      <button id=\"next\" @click=\"onNextPage\">Next</button>\r\n\r\n      <span>\r\n        Page:\r\n        <span id=\"page_num\">{{ currentPage }}</span>\r\n        /\r\n        <span id=\"page_count\">{{ totalPages }}</span></span\r\n      >\r\n    </div>\r\n\r\n    <div :style=\"`margin:0 auto;width:${pdfWidth};`\">\r\n      <canvas id=\"pdfCanvas\"></canvas>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nconst PDFJS = require('pdfjs-dist');\r\nPDFJS.GlobalWorkerOptions.workerSrc =\r\n  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.js';\r\nexport default {\r\n  data() {\r\n    return {\r\n      totalPages: [], // 总页数\r\n      currentPage: 1, // 当前页\r\n      pageRendering: false, // 是否正在渲染\r\n      pageNumPending: null, // 待处理页码\r\n      pdfWidth: '', // 宽度\r\n      pdfSrc: '', // 地址\r\n      pdfDoc: null, // 文档内容\r\n      pdfScale: 1.0 // 放大倍数\r\n      // isLoading: false // 文档是否正在加载\r\n    };\r\n  },\r\n  mounted() {\r\n    this.getPdfUrl();\r\n  },\r\n  watch: {\r\n    pageRendering(newVal, old) {\r\n      // this.isLoading = newVal;\r\n      console.log(old);\r\n    }\r\n  },\r\n  methods: {\r\n    getPdfUrl() {\r\n      // todo 请求后台，获取pdf的url，注意这里不能是本地的pdf文件\r\n      this.pdfSrc =\r\n        'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf';\r\n      this.loadFile(this.pdfSrc);\r\n    },\r\n    loadFile(url) {\r\n      //通过promise获取页面\r\n      let loadingTask = PDFJS.getDocument(url);\r\n      this.pageRendering = true;\r\n      loadingTask.promise.then((pdf) => {\r\n        this.pdfDoc = pdf;\r\n        this.totalPages = pdf.numPages;\r\n        this.$nextTick(() => {\r\n          this.renderPage(1); // 初始/首页渲染\r\n        });\r\n      });\r\n    },\r\n    renderPage(num) {\r\n      this.currentPage = num; // 更新当前页码\r\n      this.pdfDoc.getPage(num).then((page) => {\r\n        let canvas = document.getElementById('pdfCanvas');\r\n        let ctx = canvas.getContext('2d');\r\n        let dpr = window.devicePixelRatio || 1;\r\n        let bsr =\r\n          ctx.webkitBackingStorePixelRatio ||\r\n          ctx.mozBackingStorePixelRatio ||\r\n          ctx.msBackingStorePixelRatio ||\r\n          ctx.oBackingStorePixelRatio ||\r\n          ctx.backingStorePixelRatio ||\r\n          1;\r\n        let ratio = dpr / bsr;\r\n        let viewport = page.getViewport({ scale: this.pdfScale });\r\n        canvas.width = viewport.width * ratio;\r\n        canvas.height = viewport.height * ratio;\r\n\r\n        canvas.style.width = viewport.width + 'px';\r\n\r\n        this.pdfWidth = viewport.width + 'px';\r\n\r\n        canvas.style.height = viewport.height + 'px';\r\n\r\n        ctx.setTransform(ratio, 0, 0, ratio, 0, 0);\r\n        // 将 PDF 页面渲染到 canvas 上下文中\r\n        let renderContext = {\r\n          canvasContext: ctx,\r\n          viewport: viewport\r\n        };\r\n        let renderTask = page.render(renderContext);\r\n        renderTask.promise.then(() => {\r\n          this.pageRendering = false;\r\n          if (this.pageNumPending === null) return;\r\n          this.renderPage(this.pageNumPending);\r\n          this.pageNumPending = null;\r\n        });\r\n      });\r\n    },\r\n    onPrePage() {\r\n      // 上一页\r\n      if (this.currentPage <= 1) return;\r\n      this.currentPage--;\r\n      this.queueRender(this.currentPage);\r\n    },\r\n    onNextPage() {\r\n      // 下一页\r\n      if (this.currentPage >= this.totalPages) return;\r\n      this.currentPage++;\r\n      this.queueRender(this.currentPage);\r\n    },\r\n    queueRender(num) {\r\n      //渲染等待；如果正在进行另一个页面渲染，请等待渲染完成。 否则，立即执行渲染\r\n      !this.pageRendering ? this.renderPage(num) : (this.pageNumPending = num);\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style>\r\n.preview-pdf h1 {\r\n  margin: 30px auto;\r\n  text-align: center;\r\n  font-family: '宋体';\r\n  letter-spacing: 2px;\r\n}\r\n</style>\r\n"]}]}