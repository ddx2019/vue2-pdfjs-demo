{"remainingRequest":"G:\\pdf\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\pdf\\src\\components\\previewPDF.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"G:\\pdf\\src\\components\\previewPDF.vue","mtime":1611732235569},{"path":"G:\\pdf\\node_modules\\css-loader\\dist\\cjs.js","mtime":1603074898938},{"path":"G:\\pdf\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1608703742340},{"path":"G:\\pdf\\node_modules\\postcss-loader\\src\\index.js","mtime":1597828001655},{"path":"G:\\pdf\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1602294150526},{"path":"G:\\pdf\\node_modules\\vue-loader\\lib\\index.js","mtime":1608703742340}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQoucHJldmlldy1wZGYgaDEgew0KICBtYXJnaW46IDMwcHggYXV0bzsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KICBmb250LWZhbWlseTogJ+Wui+S9kyc7DQogIGxldHRlci1zcGFjaW5nOiAycHg7DQp9DQo="},{"version":3,"sources":["previewPDF.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+HA;AACA;AACA;AACA;AACA;AACA","file":"previewPDF.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"preview-pdf\">\r\n    <h1>PDF在线预览</h1>\r\n    <div style=\"text-align:center;\">\r\n      <button id=\"prev\" @click=\"onPrePage\">\r\n        Previous\r\n      </button>\r\n      <button id=\"next\" @click=\"onNextPage\">Next</button>\r\n\r\n      <span>\r\n        Page:\r\n        <span id=\"page_num\">{{ currentPage }}</span>\r\n        /\r\n        <span id=\"page_count\">{{ totalPages }}</span></span\r\n      >\r\n    </div>\r\n\r\n    <div :style=\"`margin:0 auto;width:${pdfWidth};`\">\r\n      <canvas id=\"pdfCanvas\"></canvas>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nconst PDFJS = require('pdfjs-dist');\r\nPDFJS.GlobalWorkerOptions.workerSrc =\r\n  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.js';\r\nexport default {\r\n  data() {\r\n    return {\r\n      totalPages: [], // 总页数\r\n      currentPage: 1, // 当前页\r\n      pageRendering: false, // 是否正在渲染\r\n      pageNumPending: null, // 待处理页码\r\n      pdfWidth: '', // 宽度\r\n      pdfSrc: '', // 地址\r\n      pdfDoc: null, // 文档内容\r\n      pdfScale: 1.0 // 放大倍数\r\n      // isLoading: false // 文档是否正在加载\r\n    };\r\n  },\r\n  mounted() {\r\n    this.getPdfUrl();\r\n  },\r\n  watch: {\r\n    pageRendering(newVal, old) {\r\n      // this.isLoading = newVal;\r\n      console.log(old);\r\n    }\r\n  },\r\n  methods: {\r\n    getPdfUrl() {\r\n      // todo 请求后台，获取pdf的url，注意这里不能是本地的pdf文件\r\n      this.pdfSrc =\r\n        'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf';\r\n      this.loadFile(this.pdfSrc);\r\n    },\r\n    loadFile(url) {\r\n      //通过promise获取页面\r\n      let loadingTask = PDFJS.getDocument(url);\r\n      this.pageRendering = true;\r\n      loadingTask.promise.then((pdf) => {\r\n        this.pdfDoc = pdf;\r\n        this.totalPages = pdf.numPages;\r\n        this.$nextTick(() => {\r\n          this.renderPage(1); // 初始/首页渲染\r\n        });\r\n      });\r\n    },\r\n    renderPage(num) {\r\n      this.currentPage = num; // 更新当前页码\r\n      this.pdfDoc.getPage(num).then((page) => {\r\n        let canvas = document.getElementById('pdfCanvas');\r\n        let ctx = canvas.getContext('2d');\r\n        let dpr = window.devicePixelRatio || 1;\r\n        let bsr =\r\n          ctx.webkitBackingStorePixelRatio ||\r\n          ctx.mozBackingStorePixelRatio ||\r\n          ctx.msBackingStorePixelRatio ||\r\n          ctx.oBackingStorePixelRatio ||\r\n          ctx.backingStorePixelRatio ||\r\n          1;\r\n        let ratio = dpr / bsr;\r\n        let viewport = page.getViewport({ scale: this.pdfScale });\r\n        canvas.width = viewport.width * ratio;\r\n        canvas.height = viewport.height * ratio;\r\n\r\n        canvas.style.width = viewport.width + 'px';\r\n\r\n        this.pdfWidth = viewport.width + 'px';\r\n\r\n        canvas.style.height = viewport.height + 'px';\r\n\r\n        ctx.setTransform(ratio, 0, 0, ratio, 0, 0);\r\n        // 将 PDF 页面渲染到 canvas 上下文中\r\n        let renderContext = {\r\n          canvasContext: ctx,\r\n          viewport: viewport\r\n        };\r\n        let renderTask = page.render(renderContext);\r\n        renderTask.promise.then(() => {\r\n          this.pageRendering = false;\r\n          if (this.pageNumPending === null) return;\r\n          this.renderPage(this.pageNumPending);\r\n          this.pageNumPending = null;\r\n        });\r\n      });\r\n    },\r\n    onPrePage() {\r\n      // 上一页\r\n      if (this.currentPage <= 1) return;\r\n      this.currentPage--;\r\n      this.queueRender(this.currentPage);\r\n    },\r\n    onNextPage() {\r\n      // 下一页\r\n      if (this.currentPage >= this.totalPages) return;\r\n      this.currentPage++;\r\n      this.queueRender(this.currentPage);\r\n    },\r\n    queueRender(num) {\r\n      //渲染等待；如果正在进行另一个页面渲染，请等待渲染完成。 否则，立即执行渲染\r\n      !this.pageRendering ? this.renderPage(num) : (this.pageNumPending = num);\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style>\r\n.preview-pdf h1 {\r\n  margin: 30px auto;\r\n  text-align: center;\r\n  font-family: '宋体';\r\n  letter-spacing: 2px;\r\n}\r\n</style>\r\n"]}]}