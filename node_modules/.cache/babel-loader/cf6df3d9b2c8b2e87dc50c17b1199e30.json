{"remainingRequest":"G:\\pdf\\node_modules\\babel-loader\\lib\\index.js!G:\\pdf\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!G:\\pdf\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\pdf\\src\\components\\previewPDF.vue?vue&type=script&lang=js&","dependencies":[{"path":"G:\\pdf\\src\\components\\previewPDF.vue","mtime":1611733991519},{"path":"G:\\pdf\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1611734053669},{"path":"G:\\pdf\\node_modules\\babel-loader\\lib\\index.js","mtime":1611734053369},{"path":"G:\\pdf\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1611734053669},{"path":"G:\\pdf\\node_modules\\vue-loader\\lib\\index.js","mtime":1611734068101}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KdmFyIFBERkpTID0gcmVxdWlyZSgncGRmanMtZGlzdCcpOwoKUERGSlMuR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMgPSAnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvcGRmLmpzLzIuNi4zNDcvcGRmLndvcmtlci5qcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdG90YWxQYWdlczogW10sCiAgICAgIC8vIOaAu+mhteaVsAogICAgICBjdXJyZW50UGFnZTogMSwKICAgICAgLy8g5b2T5YmN6aG1CiAgICAgIHBhZ2VSZW5kZXJpbmc6IGZhbHNlLAogICAgICAvLyDmmK/lkKbmraPlnKjmuLLmn5MKICAgICAgcGFnZU51bVBlbmRpbmc6IG51bGwsCiAgICAgIC8vIOW+heWkhOeQhumhteeggQogICAgICBwZGZXaWR0aDogJycsCiAgICAgIC8vIOWuveW6pgogICAgICBwZGZTcmM6ICcnLAogICAgICAvLyDlnLDlnYAKICAgICAgcGRmRG9jOiBudWxsLAogICAgICAvLyDmlofmoaPlhoXlrrkKICAgICAgcGRmU2NhbGU6IDEuMCAvLyDmlL7lpKflgI3mlbAKICAgICAgLy8gaXNMb2FkaW5nOiBmYWxzZSAvLyDmlofmoaPmmK/lkKbmraPlnKjliqDovb0KCiAgICB9OwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHRoaXMuZ2V0UGRmVXJsKCk7CiAgfSwKICB3YXRjaDogewogICAgcGFnZVJlbmRlcmluZzogZnVuY3Rpb24gcGFnZVJlbmRlcmluZyhuZXdWYWwsIG9sZCkgewogICAgICAvLyB0aGlzLmlzTG9hZGluZyA9IG5ld1ZhbDsKICAgICAgY29uc29sZS5sb2cob2xkKTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGdldFBkZlVybDogZnVuY3Rpb24gZ2V0UGRmVXJsKCkgewogICAgICAvLyB0b2RvIOivt+axguWQjuWPsO+8jOiOt+WPlnBkZueahHVybO+8jOazqOaEj+i/memHjOS4jeiDveaYr+acrOWcsOeahHBkZuaWh+S7tgogICAgICB0aGlzLnBkZlNyYyA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbW96aWxsYS9wZGYuanMvYmEyZWRlYWUvd2ViL2NvbXByZXNzZWQudHJhY2Vtb25rZXktcGxkaS0wOS5wZGYnOwogICAgICB0aGlzLmxvYWRGaWxlKHRoaXMucGRmU3JjKTsKICAgIH0sCiAgICBsb2FkRmlsZTogZnVuY3Rpb24gbG9hZEZpbGUodXJsKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL+mAmui/h3Byb21pc2Xojrflj5bpobXpnaIKICAgICAgdmFyIGxvYWRpbmdUYXNrID0gUERGSlMuZ2V0RG9jdW1lbnQodXJsKTsKICAgICAgdGhpcy5wYWdlUmVuZGVyaW5nID0gdHJ1ZTsKICAgICAgbG9hZGluZ1Rhc2sucHJvbWlzZS50aGVuKGZ1bmN0aW9uIChwZGYpIHsKICAgICAgICBfdGhpcy5wZGZEb2MgPSBwZGY7CiAgICAgICAgX3RoaXMudG90YWxQYWdlcyA9IHBkZi5udW1QYWdlczsKCiAgICAgICAgX3RoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnJlbmRlclBhZ2UoMSk7IC8vIOWIneWniy/pppbpobXmuLLmn5MKCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlbmRlclBhZ2U6IGZ1bmN0aW9uIHJlbmRlclBhZ2UobnVtKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IG51bTsgLy8g5pu05paw5b2T5YmN6aG156CBCgogICAgICB0aGlzLnBkZkRvYy5nZXRQYWdlKG51bSkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGRmQ2FudmFzJyk7CiAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIHZhciBkcHIgPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwogICAgICAgIHZhciBic3IgPSBjdHgud2Via2l0QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgubXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGN0eC5vQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHguYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCAxOwogICAgICAgIHZhciByYXRpbyA9IGRwciAvIGJzcjsKICAgICAgICB2YXIgdmlld3BvcnQgPSBwYWdlLmdldFZpZXdwb3J0KHsKICAgICAgICAgIHNjYWxlOiBfdGhpczIucGRmU2NhbGUKICAgICAgICB9KTsKICAgICAgICBjYW52YXMud2lkdGggPSB2aWV3cG9ydC53aWR0aCAqIHJhdGlvOwogICAgICAgIGNhbnZhcy5oZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgKiByYXRpbzsKICAgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSB2aWV3cG9ydC53aWR0aCArICdweCc7CiAgICAgICAgX3RoaXMyLnBkZldpZHRoID0gdmlld3BvcnQud2lkdGggKyAncHgnOwogICAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgKyAncHgnOwogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0ocmF0aW8sIDAsIDAsIHJhdGlvLCAwLCAwKTsgLy8g5bCGIFBERiDpobXpnaLmuLLmn5PliLAgY2FudmFzIOS4iuS4i+aWh+S4rQoKICAgICAgICB2YXIgcmVuZGVyQ29udGV4dCA9IHsKICAgICAgICAgIGNhbnZhc0NvbnRleHQ6IGN0eCwKICAgICAgICAgIHZpZXdwb3J0OiB2aWV3cG9ydAogICAgICAgIH07CiAgICAgICAgdmFyIHJlbmRlclRhc2sgPSBwYWdlLnJlbmRlcihyZW5kZXJDb250ZXh0KTsKICAgICAgICByZW5kZXJUYXNrLnByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIucGFnZVJlbmRlcmluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKF90aGlzMi5wYWdlTnVtUGVuZGluZyA9PT0gbnVsbCkgcmV0dXJuOwoKICAgICAgICAgIF90aGlzMi5yZW5kZXJQYWdlKF90aGlzMi5wYWdlTnVtUGVuZGluZyk7CgogICAgICAgICAgX3RoaXMyLnBhZ2VOdW1QZW5kaW5nID0gbnVsbDsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgb25QcmVQYWdlOiBmdW5jdGlvbiBvblByZVBhZ2UoKSB7CiAgICAgIC8vIOS4iuS4gOmhtQogICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA8PSAxKSByZXR1cm47CiAgICAgIHRoaXMuY3VycmVudFBhZ2UtLTsKICAgICAgdGhpcy5xdWV1ZVJlbmRlcih0aGlzLmN1cnJlbnRQYWdlKTsKICAgIH0sCiAgICBvbk5leHRQYWdlOiBmdW5jdGlvbiBvbk5leHRQYWdlKCkgewogICAgICAvLyDkuIvkuIDpobUKICAgICAgaWYgKHRoaXMuY3VycmVudFBhZ2UgPj0gdGhpcy50b3RhbFBhZ2VzKSByZXR1cm47CiAgICAgIHRoaXMuY3VycmVudFBhZ2UrKzsKICAgICAgdGhpcy5xdWV1ZVJlbmRlcih0aGlzLmN1cnJlbnRQYWdlKTsKICAgIH0sCiAgICBxdWV1ZVJlbmRlcjogZnVuY3Rpb24gcXVldWVSZW5kZXIobnVtKSB7CiAgICAgIC8v5riy5p+T562J5b6F77yb5aaC5p6c5q2j5Zyo6L+b6KGM5Y+m5LiA5Liq6aG16Z2i5riy5p+T77yM6K+3562J5b6F5riy5p+T5a6M5oiQ44CCIOWQpuWIme+8jOeri+WNs+aJp+ihjOa4suafkwogICAgICAhdGhpcy5wYWdlUmVuZGVyaW5nID8gdGhpcy5yZW5kZXJQYWdlKG51bSkgOiB0aGlzLnBhZ2VOdW1QZW5kaW5nID0gbnVtOwogICAgfQogIH0KfTs="},{"version":3,"sources":["previewPDF.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"preview-pdf\">\r\n    <h1>PDF在线预览</h1>\r\n    <div style=\"text-align:center;\">\r\n      <button id=\"prev\" @click=\"onPrePage\">\r\n        Previous\r\n      </button>\r\n      <button id=\"next\" @click=\"onNextPage\">Next</button>\r\n\r\n      <span>\r\n        Page:\r\n        <span id=\"page_num\">{{ currentPage }}</span>\r\n        /\r\n        <span id=\"page_count\">{{ totalPages }}</span></span\r\n      >\r\n    </div>\r\n\r\n    <div :style=\"`margin:0 auto;width:${pdfWidth};`\">\r\n      <canvas id=\"pdfCanvas\"></canvas>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nconst PDFJS = require('pdfjs-dist');\r\nPDFJS.GlobalWorkerOptions.workerSrc =\r\n  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.js';\r\nexport default {\r\n  data() {\r\n    return {\r\n      totalPages: [], // 总页数\r\n      currentPage: 1, // 当前页\r\n      pageRendering: false, // 是否正在渲染\r\n      pageNumPending: null, // 待处理页码\r\n      pdfWidth: '', // 宽度\r\n      pdfSrc: '', // 地址\r\n      pdfDoc: null, // 文档内容\r\n      pdfScale: 1.0 // 放大倍数\r\n      // isLoading: false // 文档是否正在加载\r\n    };\r\n  },\r\n  mounted() {\r\n    this.getPdfUrl();\r\n  },\r\n  watch: {\r\n    pageRendering(newVal, old) {\r\n      // this.isLoading = newVal;\r\n      console.log(old);\r\n    }\r\n  },\r\n  methods: {\r\n    getPdfUrl() {\r\n      // todo 请求后台，获取pdf的url，注意这里不能是本地的pdf文件\r\n      this.pdfSrc =\r\n        'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf';\r\n      this.loadFile(this.pdfSrc);\r\n    },\r\n    loadFile(url) {\r\n      //通过promise获取页面\r\n      let loadingTask = PDFJS.getDocument(url);\r\n      this.pageRendering = true;\r\n      loadingTask.promise.then((pdf) => {\r\n        this.pdfDoc = pdf;\r\n        this.totalPages = pdf.numPages;\r\n        this.$nextTick(() => {\r\n          this.renderPage(1); // 初始/首页渲染\r\n        });\r\n      });\r\n    },\r\n    renderPage(num) {\r\n      this.currentPage = num; // 更新当前页码\r\n      this.pdfDoc.getPage(num).then((page) => {\r\n        let canvas = document.getElementById('pdfCanvas');\r\n        let ctx = canvas.getContext('2d');\r\n        let dpr = window.devicePixelRatio || 1;\r\n        let bsr =\r\n          ctx.webkitBackingStorePixelRatio ||\r\n          ctx.mozBackingStorePixelRatio ||\r\n          ctx.msBackingStorePixelRatio ||\r\n          ctx.oBackingStorePixelRatio ||\r\n          ctx.backingStorePixelRatio ||\r\n          1;\r\n        let ratio = dpr / bsr;\r\n        let viewport = page.getViewport({ scale: this.pdfScale });\r\n        canvas.width = viewport.width * ratio;\r\n        canvas.height = viewport.height * ratio;\r\n\r\n        canvas.style.width = viewport.width + 'px';\r\n\r\n        this.pdfWidth = viewport.width + 'px';\r\n\r\n        canvas.style.height = viewport.height + 'px';\r\n\r\n        ctx.setTransform(ratio, 0, 0, ratio, 0, 0);\r\n        // 将 PDF 页面渲染到 canvas 上下文中\r\n        let renderContext = {\r\n          canvasContext: ctx,\r\n          viewport: viewport\r\n        };\r\n        let renderTask = page.render(renderContext);\r\n        renderTask.promise.then(() => {\r\n          this.pageRendering = false;\r\n          if (this.pageNumPending === null) return;\r\n          this.renderPage(this.pageNumPending);\r\n          this.pageNumPending = null;\r\n        });\r\n      });\r\n    },\r\n    onPrePage() {\r\n      // 上一页\r\n      if (this.currentPage <= 1) return;\r\n      this.currentPage--;\r\n      this.queueRender(this.currentPage);\r\n    },\r\n    onNextPage() {\r\n      // 下一页\r\n      if (this.currentPage >= this.totalPages) return;\r\n      this.currentPage++;\r\n      this.queueRender(this.currentPage);\r\n    },\r\n    queueRender(num) {\r\n      //渲染等待；如果正在进行另一个页面渲染，请等待渲染完成。 否则，立即执行渲染\r\n      !this.pageRendering ? this.renderPage(num) : (this.pageNumPending = num);\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style>\r\n.preview-pdf h1 {\r\n  margin: 30px auto;\r\n  text-align: center;\r\n  font-family: '宋体';\r\n  letter-spacing: 2px;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/components"}]}